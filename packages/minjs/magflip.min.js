!function(e){"use strict";let t=class{constructor(e,t){this.width=e,this.height=t,this.diagonal=Math.sqrt(Math.pow(e,2)+Math.pow(t,2))}};e.PageType=void 0,function(e){e.Page="Page",e.Cover="Cover",e.Empty="Empty",e.Blank="Blank"}(e.PageType||(e.PageType={})),e.DefaultSize=void 0,function(e){e[e.bookWidth=600]="bookWidth",e[e.bookHeight=900]="bookHeight",e[e.pageWidth=600]="pageWidth",e[e.pageHeight=900]="pageHeight"}(e.DefaultSize||(e.DefaultSize={})),e.BookType=void 0,function(e){e.Book="Book",e.Magazine="Magazine",e.Newspaper="Newspaper"}(e.BookType||(e.BookType={})),e.BookStatus=void 0,function(e){e.Open="Open",e.Close="Close"}(e.BookStatus||(e.BookStatus={})),e.EventStatus=void 0,function(e){e[e.None=0]="None",e[e.AutoFlip=8]="AutoFlip",e[e.AutoFlipFromCorner=12]="AutoFlipFromCorner",e[e.AutoFlipToCorner=10]="AutoFlipToCorner",e[e.Flipping=128]="Flipping",e[e.SnappingBack=144]="SnappingBack",e[e.FlippingForward=160]="FlippingForward",e[e.FlippingBackward=192]="FlippingBackward",e[e.Dragging=2048]="Dragging"}(e.EventStatus||(e.EventStatus={})),e.Zone=void 0,function(e){e[e.LT=66]="LT",e[e.LC=34]="LC",e[e.LB=18]="LB",e[e.RT=65]="RT",e[e.RC=33]="RC",e[e.RB=17]="RB",e[e.Left=2]="Left",e[e.Right=1]="Right",e[e.Top=64]="Top",e[e.Center=32]="Center",e[e.Bottom=16]="Bottom"}(e.Zone||(e.Zone={})),e.AutoFlipType=void 0,function(e){e[e.FixedWidth=0]="FixedWidth",e[e.MouseCursor=1]="MouseCursor"}(e.AutoFlipType||(e.AutoFlipType={})),e.ViewerType=void 0,function(e){e.Flipping="flipping",e.Scrolling="scrolling"}(e.ViewerType||(e.ViewerType={}));let i=class{constructor(e){this.x=(null==e?void 0:e.x)||0,this.y=(null==e?void 0:e.y)||0}toString(){return`${this.x},${this.y}`}},o=class{constructor(e){this.left=(null==e?void 0:e.left)||0,this.right=(null==e?void 0:e.right)||0,this.top=(null==e?void 0:e.top)||0,this.bottom=(null==e?void 0:e.bottom)||0,this.width=(null==e?void 0:e.width)||0,this.height=(null==e?void 0:e.height)||0,this.center=new i({x:(this.left+this.right)/2,y:(this.top+this.bottom)/2})}get leftTop(){return{x:this.left,y:this.top}}get leftCenter(){return{x:this.left,y:this.center.y}}get leftBottom(){return{x:this.left,y:this.bottom}}get rightTop(){return{x:this.right,y:this.top}}get rightCenter(){return{x:this.right,y:this.center.y}}get rightBottom(){return{x:this.right,y:this.bottom}}get centerTop(){return{x:this.center.x,y:this.top}}get centerCenter(){return this.center}get centerBottom(){return{x:this.center.x,y:this.bottom}}};class n{constructor(e,t){this.width=e,this.height=t,this.diagonal=Math.sqrt(Math.pow(e,2)+Math.pow(t,2))}}class s{constructor(e){this.closed=new n(e.closed.width,e.closed.height),this.opened=new n(e.opened.width,e.opened.height)}}class a{constructor(){this.listeners={}}addEventListener(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)}removeEventListener(e,t){this.listeners[e]&&(this.listeners[e]=this.listeners[e].filter((e=>e!==t)))}emitEvent(e,...t){this.listeners[e]&&this.listeners[e].forEach((e=>e(...t)))}}var r,h,l,p,d,c,g,u,w,f,b,m,v,k,y,x,P,C,E,S,A,B,F,L,M;!function(e){e.Page="Page",e.Cover="Cover",e.Empty="Empty",e.Blank="Blank"}(r||(r={})),function(e){e[e.bookWidth=600]="bookWidth",e[e.bookHeight=900]="bookHeight",e[e.pageWidth=600]="pageWidth",e[e.pageHeight=900]="pageHeight"}(h||(h={})),function(e){e.Book="Book",e.Magazine="Magazine",e.Newspaper="Newspaper"}(l||(l={})),function(e){e.Open="Open",e.Close="Close"}(p||(p={})),function(e){e[e.None=0]="None",e[e.AutoFlip=8]="AutoFlip",e[e.AutoFlipFromCorner=12]="AutoFlipFromCorner",e[e.AutoFlipToCorner=10]="AutoFlipToCorner",e[e.Flipping=128]="Flipping",e[e.SnappingBack=144]="SnappingBack",e[e.FlippingForward=160]="FlippingForward",e[e.FlippingBackward=192]="FlippingBackward",e[e.Dragging=2048]="Dragging"}(d||(d={})),function(e){e[e.LT=66]="LT",e[e.LC=34]="LC",e[e.LB=18]="LB",e[e.RT=65]="RT",e[e.RC=33]="RC",e[e.RB=17]="RB",e[e.Left=2]="Left",e[e.Right=1]="Right",e[e.Top=64]="Top",e[e.Center=32]="Center",e[e.Bottom=16]="Bottom"}(c||(c={})),function(e){e[e.FixedWidth=0]="FixedWidth",e[e.MouseCursor=1]="MouseCursor"}(g||(g={})),function(e){e.Flipping="flipping",e.Scrolling="scrolling"}(u||(u={}));class z extends a{constructor(){super()}}function T(e,t,i,o){return new(i||(i=Promise))((function(t,n){function s(e){try{r(o.next(e))}catch(e){n(e)}}function a(e){try{r(o.throw(e))}catch(e){n(e)}}function r(e){var o;e.done?t(e.value):(o=e.value,o instanceof i?o:new i((function(e){e(o)}))).then(s,a)}r((o=o.apply(e,[])).next())}))}"function"==typeof SuppressedError&&SuppressedError;class V extends z{constructor(e){super(),this.thumbnails=e.thumbnails||{spine:"resources/default_spine.webp",small:"resources/default_small.webp",medium:"resources/default_medium.webp",cover:{front:"resources/default_front_cover.webp",back:"resources/default_back_cover.webp"}};const t=this.createBookElement();this.elementOnShelf=t.bookOnShelfEl,this.element=t.bookEl,this.pageContainerEl=t.containerEl}appendPageEl(e){this.pageContainerEl.appendChild(e)}prependPageEl(e){this.pageContainerEl.prepend(e)}removePageEl(e){this.pageContainerEl.removeChild(e)}createBookElement(){const e=document.createElement("div");e.className="book-on-shelf";const t=document.createElement("img");t.src=this.thumbnails.medium,e.appendChild(t);const i=document.createElement("div"),o=document.createElement("div");return i.className="book",o.className="container",i.appendChild(o),{bookOnShelfEl:e,bookEl:i,containerEl:o}}clearPageEls(){this.pageContainerEl.innerHTML=""}resetBookEls(){Array.from(this.element.children).forEach((e=>{e!==this.pageContainerEl&&this.element.removeChild(e)})),this.clearPageEls()}}class R extends z{constructor(e){super(),({element:this.element,contentContainerEl:this.contentContainerEl,contentEl:this.contentEl}=this.createPageElement(e))}createPageElement(e){const t=document.createElement("div");if(t.className="page",t.setAttribute("pageIdx",`${e.index}`),e.type==r.Empty){const e=document.createElement("div");e.className="content-container";const i=document.createElement("div");return i.className="content",e.appendChild(i),t.classList.add("empty"),t.appendChild(e),{element:t,contentContainerEl:e,contentEl:i}}if(e.type==r.Blank){const e=document.createElement("div");e.className="content-container";const i=document.createElement("div");return i.className="content",e.appendChild(i),t.classList.add("blank"),t.appendChild(e),{element:t,contentContainerEl:e,contentEl:i}}{const i=document.createElement("div");i.className="content-container";const o=document.createElement("div");return o.className="content",o.innerHTML=e.content||"",o.innerHTML+=e.image?`<img src="${e.image}"/>`:"",i.appendChild(o),t.appendChild(i),{element:t,contentContainerEl:i,contentEl:o}}}resetPageEls(){Array.from(this.element.children).forEach((e=>{if(e===this.contentContainerEl){Array.from(e.children).forEach((t=>{t!==this.contentEl&&e.removeChild(t)}))}else this.element.removeChild(e)}))}}e.PageEvent=void 0,e.PageEvent||(e.PageEvent={});class $ extends R{constructor(e){super(e),this.id=e.id,this.type=e.type||r.Page,this.number=e.number||void 0,this.size=e.size||{width:h.pageWidth,height:h.pageHeight},this.index=e.index,this.ignore=e.ignore||!1,this.content=e.content||"",this.image=e.image||"",this.setEvents()}static emptyPage(e,t){return this.createEmptyOrBlankPage(r.Empty,e,t)}static blankPage(e,t){return this.createEmptyOrBlankPage(r.Blank,e,t)}static createEmptyOrBlankPage(e,t,i){return new $({id:`emptyPage${t}`,type:e,size:i,number:void 0,index:t,ignore:!0,content:""})}setEvents(){}}e.BookEvent=void 0,function(e){e.pageAdded="pageAdded"}(e.BookEvent||(e.BookEvent={}));class O extends V{constructor(e){super(e),this.id=e.id,this.status=p.Close,this.type=e.type||l.Book,this.title=e.title||"Title",this.author=e.author||"Author",this.publication=e.publication||{name:"Publisher",location:"Location",publishedDate:"Published Date"},this.size=new s(e.size||{closed:new n(h.bookWidth,h.bookHeight),opened:new n(2*h.bookWidth,h.bookHeight)}),this.lastPageIndex=e.lastPageIndex%2==0?e.lastPageIndex+1:e.lastPageIndex,this.pages={},this.thumbnails=e.thumbnails||{spine:"resources/default_spine.webp",small:"resources/default_small.webp",medium:"resources/default_medium.webp",cover:{front:"resources/default_front_cover.webp",back:"resources/default_back_cover.webp"}}}fetchPage(e){return T(this,0,void 0,(function*(){const t={id:`page${e}`,type:r.Page,size:{width:600,height:900},index:e,number:void 0,ignore:!1,content:"",image:`./resources/page${e}.jpg`},i=new $(t);return this.addPage(i,e),new Promise(((e,i)=>{e(t)}))}))}fetchPages(e){return T(this,0,void 0,(function*(){let t=e.start;t<0&&(t=0);const i=[];let o=t+e.cnt;o>this.lastPageIndex&&(o=this.lastPageIndex);for(let e=t;e<o;e++)this.pages[e]||i.push({id:`page${e}`,type:r.Page,size:{width:600,height:900},index:e,number:void 0,ignore:!1,content:"",image:`./resources/page${e}.jpg`});return i.forEach((e=>{const t=new $(e);this.addPage(t,t.index)})),new Promise(((e,t)=>{e(i)}))}))}importPages(e,t){this.size.closed=new n(t.width,t.height),this.size.opened=new n(2*t.width,t.height),e.forEach((e=>{const t=new $(e);this.addPage(t,t.index)}))}addPage(t,i){this.pages[i]=t,this.emitEvent(e.BookEvent.pageAdded,t)}removePage(e){delete this.pages[e]}getPage(e){return this.pages[e]}getPages(){return this.pages}getPageCnt(){return Object.keys(this.pages).length}getPageEl(e){return this.pages[e].element}createEmptyPage(e,t){const i=$.emptyPage(e,t||this.size.closed);return this.addPage(i,e),i}setEvents(e,t){}resetBook(){return new Promise(((e,t)=>{this.element.removeAttribute("style"),this.resetBookEls();for(const e in this.pages){const t=this.pages[e];t.type==r.Empty&&this.removePage(Number(e)),t.resetPageEls()}e()}))}}class N{constructor(e){this.booksOnShelf={},this.bookManager=e,this.bookShelfDocId="bookShelf",this.element=this.createElement()}createElement(){let e=document.getElementById(this.bookShelfDocId);return e||(e=document.createElement("div"),e.id=this.bookShelfDocId,document.body.appendChild(e)),e}getBookHolder(e){return this.booksOnShelf[e].bookHolderEl}getBook(e){return this.booksOnShelf[e].book}addBook(e,t){const i=e.elementOnShelf,o=document.createElement("div");o.className="book-holder",o.appendChild(i),this.element.appendChild(o),this.booksOnShelf[e.id]={book:e,bookHolderEl:o,position:Object.keys(this.booksOnShelf).length};for(const e in t)i.addEventListener(e,t[e])}putbackBook(e){if(e.elementOnShelf){this.getBookHolder(e.id).appendChild(e.elementOnShelf)}}}class I extends z{registerView(e){this.registeredViews[e.id]=e}getView(e){return this.registeredViews[e]}constructor(e){super(),this.registeredViews={},this.bookViewerDocId="bookViewer",this.bookShelfManager=e,({bookViewerEl:this.element}=this.createViewerElements())}setCurView(e){this.curView=this.getView(e)}createViewerElements(){let e=document.getElementById(this.bookViewerDocId);e?e.innerHTML="":(e=document.createElement("div"),e.id=this.bookViewerDocId,document.body.appendChild(e)),e.className="",e.classList.add("hidden");const t=document.createElement("button");return t.id="btnClose",t.innerHTML="X",t.addEventListener("click",(e=>{this.closeViewer()})),e.appendChild(t),{bookViewerEl:e}}view(e,t=0){if(!this.curView)throw new Error("Please select one view.");this.book=e,this.element.className="hidden";const i=this.bookContainerEl=this.curView.getBookContainerEl();this.element.appendChild(i),this.element.classList.add(this.curView.id),this.curView.view(e,t),this.element.classList.remove("hidden")}closeViewer(){var e;this.element.className="hidden",this.bookContainerEl&&this.element.removeChild(this.bookContainerEl),null===(e=this.curView)||void 0===e||e.closeViewer(),this.bookShelfManager.returnBookToShelf(this.book),this.book&&(this.book.resetBook(),this.bookContainerEl&&(this.bookContainerEl.className="",this.bookContainerEl.removeChild(this.book.element),this.bookContainerEl=void 0),this.book=void 0)}changeView(e){console.log(this.registeredViews);const t=this.getView(e);t&&(this.curView=t)}}class G{constructor(e=0,t=0,i=0){this.leftX=e,this.rightX=t,this.y=i,this._leftP={x:e,y:i},this._rightP={x:t,y:i},this._centerP={x:(e+t)/2,y:i}}get leftP(){return this._leftP}get rightP(){return this._rightP}get centerP(){return this._centerP}}class W{constructor(e){this.alpa=0,this.a=0,this.b=0,this.c=0,this.d=0,this.alpa=e.alpa,this.a=e.a,this.b=e.b,this.c=e.c,this.d=e.d,this.page2=e.page2,this.mask=e.mask,this.shadow=e.shadow}printPage1MaskShape(){const e=this.mask.page1;return`${e.p1.x},${e.p1.y} ${e.p2.x},${e.p2.y} ${e.p3.x},${e.p3.y} ${e.p4.x},${e.p4.y}`}printPage2MaskShape(){const e=this.mask.page2;return`${e.p1.x},${e.p1.y} ${e.p2.x},${e.p2.y} ${e.p3.x},${e.p3.y} ${e.p4.x},${e.p4.y}`}printShadow6(e){return this.mask.page1,`0,0 ${e.width},0 ${e.width},${e.height} 0,${e.height}`}}!function(e){e.Page="Page",e.Cover="Cover",e.Empty="Empty",e.Blank="Blank"}(w||(w={})),function(e){e[e.bookWidth=600]="bookWidth",e[e.bookHeight=900]="bookHeight",e[e.pageWidth=600]="pageWidth",e[e.pageHeight=900]="pageHeight"}(f||(f={})),function(e){e.Book="Book",e.Magazine="Magazine",e.Newspaper="Newspaper"}(b||(b={})),function(e){e.Open="Open",e.Close="Close"}(m||(m={})),function(e){e[e.None=0]="None",e[e.AutoFlip=8]="AutoFlip",e[e.AutoFlipFromCorner=12]="AutoFlipFromCorner",e[e.AutoFlipToCorner=10]="AutoFlipToCorner",e[e.Flipping=128]="Flipping",e[e.SnappingBack=144]="SnappingBack",e[e.FlippingForward=160]="FlippingForward",e[e.FlippingBackward=192]="FlippingBackward",e[e.Dragging=2048]="Dragging"}(v||(v={})),function(e){e[e.LT=66]="LT",e[e.LC=34]="LC",e[e.LB=18]="LB",e[e.RT=65]="RT",e[e.RC=33]="RC",e[e.RB=17]="RB",e[e.Left=2]="Left",e[e.Right=1]="Right",e[e.Top=64]="Top",e[e.Center=32]="Center",e[e.Bottom=16]="Bottom"}(k||(k={})),function(e){e[e.FixedWidth=0]="FixedWidth",e[e.MouseCursor=1]="MouseCursor"}(y||(y={})),function(e){e.Flipping="flipping",e.Scrolling="scrolling"}(x||(x={}));class D{constructor(e){this.x=(null==e?void 0:e.x)||0,this.y=(null==e?void 0:e.y)||0}toString(){return`${this.x},${this.y}`}}class Z{constructor(e,t){this.p1=e,this.p2=t}}class H{constructor(e){this.left=(null==e?void 0:e.left)||0,this.right=(null==e?void 0:e.right)||0,this.top=(null==e?void 0:e.top)||0,this.bottom=(null==e?void 0:e.bottom)||0,this.width=(null==e?void 0:e.width)||0,this.height=(null==e?void 0:e.height)||0,this.center=new D({x:(this.left+this.right)/2,y:(this.top+this.bottom)/2})}get leftTop(){return{x:this.left,y:this.top}}get leftCenter(){return{x:this.left,y:this.center.y}}get leftBottom(){return{x:this.left,y:this.bottom}}get rightTop(){return{x:this.right,y:this.top}}get rightCenter(){return{x:this.right,y:this.center.y}}get rightBottom(){return{x:this.right,y:this.bottom}}get centerTop(){return{x:this.center.x,y:this.top}}get centerCenter(){return this.center}get centerBottom(){return{x:this.center.x,y:this.bottom}}}class q{static findSymmetricPoint(e,t){return{x:2*e.x-t.x,y:2*e.y-t.y}}static getDegree(e,t){return 180*q.getRadian(e,t)/Math.PI}static getDegreePositive(e,t){let i=180*q.getRadian(e,t)/Math.PI%360;return i<0&&(i+=360),i}static getRadian(e,t){const i=t.x-e.x,o=t.y-e.y;return Math.atan2(o,i)}static getRadianPositive(e,t){const i=t.x-e.x,o=t.y-e.y;let n=Math.atan2(o,i)%(2*Math.PI);return n<0&&(n+=2*Math.PI),n}static getOffset(e){var t,i,o=0,n=0;let s=e.getBoundingClientRect();i=s.height,t=s.width;do{s=e.getBoundingClientRect(),o+=s.top,n+=s.left,null!==(e=e.offsetParent)&&(s=e.getBoundingClientRect(),o-=s.top-window.scrollY,n-=s.left-window.scrollX)}while(e);return{top:o,left:n,width:t,height:i,bottom:o+i,right:n+t}}static getOffset4Fixed(e){var t,i,o=0,n=0;let s=e.getBoundingClientRect();i=s.height,t=s.width;do{s=e.getBoundingClientRect(),o+=s.top,n+=s.left,null!==(e=e.offsetParent)&&(s=e.getBoundingClientRect(),o-=s.top,n-=s.left)}while(e);return new H({top:o,left:n,width:t,height:i,bottom:o+i,right:n+t})}static getLength(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}static findPointOnLine(e,t,i){const o=t.x-e.x,n=t.y-e.y,s=Math.sqrt(o*o+n*n),a=o/s,r=n/s;return{x:e.x+a*i,y:e.y+r*i}}static findPerpendicularFoot(e,t){const i=e.p2.x-e.p1.x,o=e.p2.y-e.p1.y,n=i*i+o*o;if(0===n)return e.p1;const s=((t.x-e.p1.x)*i+(t.y-e.p1.y)*o)/n;return{x:e.p1.x+i*s,y:e.p1.y+o*s}}}class _{get length(){return this._length}get radian(){return this._radian}constructor(e,t){this._length=0,this._radian=0,this._length=q.getLength(e,t),this._radian=q.getRadianPositive(e,t)}}class j{constructor(e,t){const i=new D,o={x:(null==e?void 0:e.left)||0,y:(null==t?void 0:t.y)||0},n={x:(null==e?void 0:e.right)||0,y:(null==t?void 0:t.y)||0},s=(null==e?void 0:e.centerTop)||i,a=(null==e?void 0:e.centerBottom)||i,r=new _(a,o),h=new _(a,n),l=new _(s,o),p=new _(s,n);h.radian,p.radian||Math.PI,this.area1={length:r.length,radian:{low:r.radian,high:h.radian||2*Math.PI}},this.area2={length:l.length,radian:{low:p.radian,high:l.radian}},this.area3={length:0,radian:{low:h.radian,high:p.radian||2*Math.PI}},this.area4={length:0,radian:{low:l.radian,high:r.radian}}}}class X extends H{constructor(e){super(e)}get topPoint(){return{x:this.left,y:this.top}}get bottomPoint(){return{x:this.left,y:this.bottom}}}class Y{constructor(){this.windowSize=6,this.windows=[];for(let e=0;e<this.windowSize;e++)this.windows[e]={page:void 0}}loadPageToWindow(e,t){this.windows[e].page=t}loadPagesToWindow(e){for(let t=0;t<this.windowSize;t++)this.windows[t].page=e[t]}clearPageWindow(){this.windows=[];for(let e=0;e<this.windowSize;e++)this.windows[e]={page:void 0}}moveRight(e,t){this.windows.shift(),this.windows.shift(),this.windows.push({page:e}),this.windows.push({page:t})}moveLeft(e,t){this.windows.pop(),this.windows.pop(),this.windows.unshift({page:t}),this.windows.unshift({page:e})}getPageInWindow(e){return this.windows[e].page}}class U extends Y{set eventStatus(e){this._eventStatus=e}get eventStatus(){return this._eventStatus}constructor(){super(),this._eventStatus=v.None,this.flipGRect=new H,this.gutter=new X,this.eventZone=k.RB,this.oldEventZone=k.RT,this.activeCenterGP=new D,this.activeCornerGP=new D,this.activeCornerOppositeGP=new D,this.diagonals=new j,this.flipActionLine=new G,this.curAutoFlipWidth=0,this.autoFlipWidth=20,this.curMouseGP=new D,this.setting={autoFlip:{type:y.MouseCursor}}}setInitFlipping(e,t,i){this.eventZone=e;let o=t.y;switch(e){case k.LT:case k.RT:o=this.gutter.top;break;case k.LB:case k.RB:o=this.gutter.bottom}const n=i.left==this.gutter.left?i.left-i.width:i.left,s=i.right==this.gutter.right?i.right+i.width:i.right;this.flipGRect=new H({left:n,right:s,top:this.gutter.top,bottom:this.gutter.bottom,width:s-n,height:this.gutter.height}),this.flipActionLine=new G(n,s,o),this.diagonals=new j(this.flipGRect,this.flipActionLine.centerP),this.activeCenterGP=this.flipActionLine.centerP;let a=0;switch(e){case k.LT:case k.LC:case k.LB:a=this.flipGRect.width/2,this.activeCornerGP=this.flipActionLine.leftP;break;case k.RT:case k.RC:case k.RB:a=0,this.activeCornerGP=this.flipActionLine.rightP}this.activeCornerOppositeGP=q.findSymmetricPoint(this.activeCenterGP,this.activeCornerGP);const r=this.flipActionLine.y-i.top,h=document.documentElement;h.style.setProperty("--page2-origin",`${a}px ${r}px`);const l=getComputedStyle(h).getPropertyValue("--zone-width").trim();this.autoFlipWidth=.9*parseFloat(l)}getTargetCorner(e){const t=q.getLength(e,this.activeCornerGP);return q.getLength(e,this.activeCornerOppositeGP)<t?this.activeCornerOppositeGP:this.activeCornerGP}getInfoToFlip(e){const t=this.getTargetCorner(e);return{targetCornerGP:t,isSnappingBack:t==this.activeCornerGP,isFlippingForward:t.x<this.gutter.left}}animateReadyToFlip(e,t,i,o,n){let s=this.curAutoFlipWidth;const a=this.setting.autoFlip.type==y.MouseCursor&&!(this.eventZone&k.Center),r=e?this.autoFlipWidth:0;if(a&&!e)t=this.activeCornerGP;else if(s==r)return n();const h=performance.now();let l=new D,p=new D;switch(this.eventZone){case k.LT:l={x:this.activeCornerGP.x+s,y:this.activeCornerGP.y+s},p=a?t:{x:this.activeCornerGP.x+r,y:this.activeCornerGP.y+r};break;case k.LC:l={x:this.activeCornerGP.x+s,y:this.activeCornerGP.y},p=a?t:{x:this.activeCornerGP.x+r,y:this.activeCornerGP.y};break;case k.LB:l={x:this.activeCornerGP.x+s,y:this.activeCornerGP.y-s},p=a?t:{x:this.activeCornerGP.x+r,y:this.activeCornerGP.y-r};break;case k.RT:l={x:this.activeCornerGP.x-s,y:this.activeCornerGP.y+s},p=a?t:{x:this.activeCornerGP.x-r,y:this.activeCornerGP.y+r};break;case k.RC:l={x:this.activeCornerGP.x-s,y:this.activeCornerGP.y},p=a?t:{x:this.activeCornerGP.x-r,y:this.activeCornerGP.y};break;case k.RB:l={x:this.activeCornerGP.x-s,y:this.activeCornerGP.y-s},p=a?t:{x:this.activeCornerGP.x-r,y:this.activeCornerGP.y-r}}const d=t=>{const c=this.eventStatus;if(a&&(e?p=this.curMouseGP:l=this.curMouseGP),c!=v.AutoFlipToCorner&&c!=v.AutoFlipFromCorner||e&&c==v.AutoFlipToCorner||!e&&c==v.AutoFlipFromCorner)return n();const g=(t-h)/200,u=Math.min(g,1),w=this.easeInOutQuad(u),f=l.x+(p.x-l.x)*w,b=l.y+(p.y-l.y)*w;e?s=u*r:s-=u*s,this.curAutoFlipWidth=s,o({x:f,y:b},i),u<1?requestAnimationFrame(d):n()};requestAnimationFrame(d)}animateFlipFromCorner(e,t,i,o){this.oldEventZone!=this.eventZone&&(this.curAutoFlipWidth=0),this.oldEventZone=this.eventZone,this.animateReadyToFlip(!0,e,t,i,o)}animateFlipToCorner(e,t,i,o){this.oldEventZone=this.eventZone,this.animateReadyToFlip(!1,e,t,i,o)}easeInOutQuad(e){return e<.5?2*e*e:(4-2*e)*e-1}animateFlip(e,t,i,o,n){const s=performance.now(),a=r=>{if(this.eventStatus==v.Flipping)return;const h=(r-s)/500,l=Math.min(h,1),p=this.easeInOutQuad(l),d=e.x+(t.x-e.x)*p,c=e.y+(t.y-e.y)*p;o({x:d,y:c},i),l<1?requestAnimationFrame(a):n()};requestAnimationFrame(a)}updateMousePointOnArea(e){const t=q.getRadianPositive(this.gutter.centerBottom,e),i=e.y<this.flipActionLine.y&&q.getLength(this.gutter.centerBottom,e)>this.diagonals.area1.length&&this.diagonals.area1.radian.low<=t&&t<=this.diagonals.area1.radian.high,o=q.getRadianPositive(this.gutter.centerTop,e),n=e.y>this.flipActionLine.y&&q.getLength(this.gutter.centerTop,e)>this.diagonals.area2.length&&this.diagonals.area2.radian.low<=o&&o<=this.diagonals.area2.radian.high,s=q.getRadianPositive(this.flipActionLine.rightP,e),a=this.diagonals.area3.radian.low,r=this.diagonals.area3.radian.high,h=e.x>this.flipActionLine.rightX&&q.getLength(this.flipActionLine.rightP,e)>this.diagonals.area3.length&&(a<=s&&s<=r||a>r&&a<=s||s<=r),l=q.getRadianPositive(this.flipActionLine.leftP,e),p=e.x<this.flipActionLine.leftX&&q.getLength(this.flipActionLine.leftP,e)>this.diagonals.area4.length&&this.diagonals.area4.radian.low<=l&&l<=this.diagonals.area4.radian.high;return i?e=q.findPointOnLine(this.gutter.centerBottom,e,this.diagonals.area1.length):n?e=q.findPointOnLine(this.gutter.centerTop,e,this.diagonals.area2.length):h?e=this.flipActionLine.rightP:p&&(e=this.flipActionLine.leftP),e}flip(e,t,i){const o=t.width,n=t.height;let s,a,r=0,h=1;switch(e=this.updateMousePointOnArea(e),this.eventZone){case k.LT:case k.LC:case k.LB:s={x:o,y:n},a={x:0,y:n},r=0,h=-1;break;case k.RT:case k.RC:case k.RB:s={x:0,y:n},a={x:o,y:n},r=i?o:0,h=1;break;default:throw new Error("Not found an event zone.")}const l=Math.PI/2,p=this.gutter.bottom-this.flipActionLine.y,d=q.getRadianPositive(this.activeCornerGP,e),c=h*(3*l-d),g=r+(e.x-this.gutter.left),u=e.y-this.flipActionLine.y,w=e.x-this.activeCornerGP.x,f=e.y-this.activeCornerGP.y,b=Math.cos(2*d-l),m=Math.tan(-l-h*d),v=0==f?n:-w/b+p,y=0==f?-w*h/2:v/m,x={x:s.x,y:s.y};let P={x:s.x+y*h,y:s.y},C={x:0,y:0};const E={x:s.x,y:s.y-v},S=q.getLength(e,this.activeCornerOppositeGP);0==f?C={x:P.x,y:E.y}:y<0?(C.x=s.x-h*y*(n-v)/v,C.y=E.y=n-s.y,x.y=s.y-v,P=x):v<0?(C.x=s.x+h*y*(v-n)/v,C.y=E.y=n-s.y):v<n?C=E:v>n&&(C.x=s.x+h*y*(v-n)/v,C.y=E.y=n-s.y);const A={x:a.x,y:a.y},B={x:a.x+s.x-P.x,y:P.y},F={x:a.x+s.x-C.x,y:C.y},L={x:a.x,y:E.y};return new W({page2:{top:u,left:g,rotate:2*d%(2*Math.PI)},mask:{page2:{p1:x,p2:P,p3:C,p4:E},page1:{p1:A,p2:B,p3:F,p4:L}},alpa:c,a:w,b:f,c:y,d:v,shadow:{closingDistance:S,rect:{rotate:c,origin:{x:P.x,y:0}}}})}}function Q(e,t,i,o){return new(i||(i=Promise))((function(t,n){function s(e){try{r(o.next(e))}catch(e){n(e)}}function a(e){try{r(o.throw(e))}catch(e){n(e)}}function r(e){var o;e.done?t(e.value):(o=e.value,o instanceof i?o:new i((function(e){e(o)}))).then(s,a)}r((o=o.apply(e,[])).next())}))}"function"==typeof SuppressedError&&SuppressedError,function(e){e.Page="Page",e.Cover="Cover",e.Empty="Empty",e.Blank="Blank"}(P||(P={})),function(e){e[e.bookWidth=600]="bookWidth",e[e.bookHeight=900]="bookHeight",e[e.pageWidth=600]="pageWidth",e[e.pageHeight=900]="pageHeight"}(C||(C={})),function(e){e.Book="Book",e.Magazine="Magazine",e.Newspaper="Newspaper"}(E||(E={})),function(e){e.Open="Open",e.Close="Close"}(S||(S={})),function(e){e[e.None=0]="None",e[e.AutoFlip=8]="AutoFlip",e[e.AutoFlipFromCorner=12]="AutoFlipFromCorner",e[e.AutoFlipToCorner=10]="AutoFlipToCorner",e[e.Flipping=128]="Flipping",e[e.SnappingBack=144]="SnappingBack",e[e.FlippingForward=160]="FlippingForward",e[e.FlippingBackward=192]="FlippingBackward",e[e.Dragging=2048]="Dragging"}(A||(A={})),function(e){e[e.LT=66]="LT",e[e.LC=34]="LC",e[e.LB=18]="LB",e[e.RT=65]="RT",e[e.RC=33]="RC",e[e.RB=17]="RB",e[e.Left=2]="Left",e[e.Right=1]="Right",e[e.Top=64]="Top",e[e.Center=32]="Center",e[e.Bottom=16]="Bottom"}(B||(B={})),function(e){e[e.FixedWidth=0]="FixedWidth",e[e.MouseCursor=1]="MouseCursor"}(F||(F={})),function(e){e.Flipping="flipping",e.Scrolling="scrolling"}(L||(L={})),"function"==typeof SuppressedError&&SuppressedError,function(e){e.pageAdded="pageAdded"}(M||(M={}));var K=':root{--closed-book-width:0px;--opened-book-width:0px;--book-height:0px;--page-width:0px;--page-height:0px;--zone-width:50px;--page2-top:0px;--page2-left:0px;--page2-rotate:0rad;--page2-origin:"0px 0px";--page-diagonal-length:0px;--shadow-origin-x:0px;--shadow-origin-y:0px;--shadow-left:calc(var(--page-width) - var(--page-diagonal-length));--shadow-rotate:0rad;--shadow5-opacity:0}#bookViewer.flip-view.hidden{display:none}#bookViewer.flip-view #bookContainer{align-items:center;display:flex;justify-content:center;position:relative}#bookViewer.flip-view #bookContainer .book,#bookViewer.flip-view .book>.container>.page{height:100%;width:100%}#bookViewer.flip-view #bookContainer{filter:drop-shadow(0 0 50px rgba(0,0,0,.4))}#bookViewer.flip-view #bookContainer.ready-to-open .book{width:var(--closed-book-width)}#bookViewer.flip-view #bookContainer.ready-to-open.front .book{border-radius:0 20px 20px 0}#bookViewer.flip-view #bookContainer.ready-to-open.end .book{border-radius:20px 0 0 20px}#bookViewer.flip-view #bookContainer .book{align-items:center;box-sizing:content-box;display:flex;height:var(--book-height);justify-content:center;width:var(--opened-book-width)}#bookViewer.flip-view .book>.container{align-items:center;background:transparent;display:flex;height:100%;justify-content:center;position:relative;width:100%}#bookViewer.flip-view #bookContainer.ready-to-open .book>.container>.page{width:100%}#bookViewer.flip-view .book>.container>.page.empty:nth-child(3){opacity:0}#bookViewer.flip-view #bookContainer.ready-to-open.end .book>.container>.page.empty:nth-child(n+4):nth-child(-n+6),#bookViewer.flip-view #bookContainer.ready-to-open.front .book>.container>.page.empty:nth-child(-n+3){display:none}#bookViewer.flip-view .book>.container>.page{border:0;box-sizing:border-box;height:var(--page-height);position:absolute;width:var(--page-width)}#bookViewer.flip-view .book .page:nth-child(-n+3){left:0}#bookViewer.flip-view .book .page:nth-child(n+4):nth-child(-n+6){left:50%}#bookViewer.flip-view .book .page:nth-child(2),#bookViewer.flip-view .book .page:nth-child(5){display:none}#bookViewer.flip-view #bookContainer.ready-to-open .book .page:nth-child(-n+6){left:0}#bookViewer.flip-view #bookContainer.left-page-flipping .book>.container>.page:nth-child(3),#bookViewer.flip-view #bookContainer.right-page-flipping .book>.container>.page:nth-child(4){z-index:9}#bookViewer.flip-view #bookContainer.left-page-flipping .book>.container>.page:nth-child(2),#bookViewer.flip-view #bookContainer.right-page-flipping .book>.container>.page:nth-child(5){display:block;filter:drop-shadow(0 0 40px rgba(0,0,0,var(--shadow5-opacity)));left:var(--page2-left);top:var(--page2-top);transform:rotate(var(--page2-rotate));transform-origin:var(--page2-origin);z-index:10}#bookViewer.flip-view .book>.container>.page>.content-container{box-sizing:border-box;height:100%;left:0;overflow:hidden;position:absolute;top:0;width:100%}#bookViewer.flip-view #bookContainer.left-page-flipping .book>.container>.page:nth-child(3)>.content-container,#bookViewer.flip-view #bookContainer.right-page-flipping .book>.container>.page:nth-child(4)>.content-container{mask-composite:exclude;-webkit-mask-composite:xor;mask-image:url(#mask1);-webkit-mask-image:url(#mask1);mask-size:cover}#bookViewer.flip-view #bookContainer.left-page-flipping .book>.container>.page:nth-child(2)>.content-container,#bookViewer.flip-view #bookContainer.right-page-flipping .book>.container>.page:nth-child(5)>.content-container{-webkit-mask-composite:intersect;mask-composite:intersect;-webkit-mask-image:url(#mask2);mask-image:url(#mask2);-webkit-mask-mode:alpha;mask-mode:alpha}#bookViewer.flip-view .book>.container>.page>.content-container>.content{height:100%;left:0;position:absolute;top:0;width:100%}#bookViewer.flip-view .shadow1{bottom:-10%;height:10%;left:0;position:absolute;width:100%}#bookViewer.flip-view .shadow1 path{display:none}#bookViewer.flip-view .shadow1 path.sh1-path1,#bookViewer.flip-view .shadow1 path.sh1-path2{fill:url(#shadow1);filter:url(#sh1BlurFilter)}#bookViewer.flip-view .book>.container>.page:nth-child(3) .shadow1 path.sh1-path1,#bookViewer.flip-view .book>.container>.page:nth-child(4) .shadow1 path.sh1-path2{display:block}.shadow6 polygon{fill:url(#shadow6)}#bookViewer.flip-view .book .page .shadow6{display:none;height:100%;width:100%}#bookViewer.flip-view #bookContainer.left-page-flipping .book>.container>.page:nth-child(3)>.shadow6{display:block;height:100%;left:0;position:absolute;top:0;width:calc(var(--page-width)*2)}#bookViewer.flip-view #bookContainer.right-page-flipping .book>.container>.page:nth-child(4)>.shadow6{display:block;height:100%;left:calc(var(--page-width)*-1);position:absolute;top:0;width:calc(var(--page-width)*2)}#bookViewer.flip-view #bookContainer.ready-to-open.left-page-flipping .book>.container>.page:nth-child(3)>.shadow6,#bookViewer.flip-view #bookContainer.ready-to-open.right-page-flipping .book>.container>.page:nth-child(4)>.shadow6{display:none}#bookViewer.flip-view .book>.container>.page>.content-container>.content,#bookViewer.flip-view .book>.container>.page>.shadow3{box-sizing:border-box;overflow:hidden}#bookViewer.flip-view .book>.container>.page:nth-child(odd)>.content-container,#bookViewer.flip-view .book>.container>.page:nth-child(odd)>.content-container>.content,#bookViewer.flip-view .book>.container>.page:nth-child(odd)>.shadow3{border-radius:20px 0 0 20px;border-right-width:0!important}#bookViewer.flip-view .book>.container>.page:nth-child(2n)>.content-container,#bookViewer.flip-view .book>.container>.page:nth-child(2n)>.content-container>.content,#bookViewer.flip-view .book>.container>.page:nth-child(2n)>.shadow3{border-left-width:0!important;border-radius:0 20px 20px 0}#bookViewer.flip-view .book>.container>.page>.shadow3{display:none;height:100%;left:0;position:absolute;top:0;width:100%}#bookViewer.flip-view #bookContainer.left-page-flipping .book>.container>.page:nth-child(2)>.shadow3,#bookViewer.flip-view #bookContainer.right-page-flipping .book>.container>.page:nth-child(5)>.shadow3{display:block}#bookViewer.flip-view .book>.container>.page:nth-child(odd) .shadow2{background-image:-webkit-linear-gradient(left,transparent,rgba(0,0,0,.3) 210%);border-right:1px solid rgba(71,71,71,.1);height:100%;position:absolute;right:0;top:0;width:7%}#bookViewer.flip-view .book>.container>.page:nth-child(2n) .shadow2{background-image:-webkit-linear-gradient(right,transparent,rgba(0,0,0,.3) 210%);border-left:1px solid rgba(71,71,71,.1);height:100%;left:0;position:absolute;top:0;width:7%}#bookViewer.flip-view .page.border>.content-container>.content{border:1px solid #fff}#bookViewer.flip-view .page.border>.shadow3{border:1px solid transparent}#bookViewer.flip-view .page.border .shadow3>.shape{stroke:#fff;stroke-width:1px}#bookViewer.flip-view .page:first-child{z-index:1}#bookViewer.flip-view .page:nth-child(2){z-index:2}#bookViewer.flip-view .page:nth-child(3),#bookViewer.flip-view .page:nth-child(4){z-index:3}#bookViewer.flip-view .page:nth-child(5){z-index:2}#bookViewer.flip-view .page:nth-child(6){z-index:1}#bookViewer.flip-view #bookContainer.ready-to-open.end .event-zone.right,#bookViewer.flip-view #bookContainer.ready-to-open.front .event-zone.left{display:none}#bookViewer.flip-view .event-zone{background:transparent;position:absolute;z-index:20}#bookViewer.flip-view #mzZoneLT{height:calc(var(--zone-width)*2);left:0;top:0;width:calc(var(--zone-width)*3)}#bookViewer.flip-view #mzZoneLC{height:calc(var(--page-height) - var(--zone-width)*4);left:0;top:calc(var(--zone-width)*2);width:var(--zone-width)}#bookViewer.flip-view #mzZoneLB{bottom:0;left:0}#bookViewer.flip-view #mzZoneLB,#bookViewer.flip-view #mzZoneRT{height:calc(var(--zone-width)*2);width:calc(var(--zone-width)*3)}#bookViewer.flip-view #mzZoneRT{right:0;top:0}#bookViewer.flip-view #mzZoneRC{height:calc(var(--page-height) - var(--zone-width)*2);right:0;top:calc(var(--zone-width)*2);width:var(--zone-width)}#bookViewer.flip-view #mzZoneRB{bottom:0;height:calc(var(--zone-width)*2);right:0;width:calc(var(--zone-width)*3)}img{height:100%;width:100%}';!function(e,t){void 0===t&&(t={});var i=t.insertAt;if("undefined"!=typeof document){var o=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css","top"===i&&o.firstChild?o.insertBefore(n,o.firstChild):o.appendChild(n),n.styleSheet?n.styleSheet.cssText=e:n.appendChild(document.createTextNode(e))}}(K);!function(e,t){void 0===t&&(t={});var i=t.insertAt;if("undefined"!=typeof document){var o=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css","top"===i&&o.firstChild?o.insertBefore(n,o.firstChild):o.appendChild(n),n.styleSheet?n.styleSheet.cssText=e:n.appendChild(document.createTextNode(e))}}('body,html{font-family:Noto Sans KR,sans-serif;margin:0;padding:0}#bookShelf{box-sizing:border-box;display:flex;flex-direction:row;gap:20px;padding:20px;width:100vw}#bookShelf .book-holder{border:1px solid #eee;border-radius:5px;box-shadow:1px 1px 5px #eee;padding:3px;position:relative}#bookShelf .book-holder:before{align-items:center;color:#eee;content:"MagZog";display:flex;font-size:24px;height:100%;justify-content:center;position:absolute;width:100%;z-index:-1}#bookShelf .book,#bookShelf .book-holder,#bookShelf .book-on-shelf{height:15vw;width:10vw}#bookShelf .book-on-shelf img{height:100%;width:100%}#bookShelf .book-on-shelf:hover{cursor:pointer}#bookViewer.hidden{display:none}#bookViewer{align-items:center;background:hsla(0,0%,100%,.9);box-sizing:border-box;display:flex;height:100vh;justify-content:center;left:0;padding:0;position:fixed;top:0;width:100vw}.noselect{user-select:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none}#bookViewer #btnClose{background-color:#222;border:none;border-radius:4px;color:#fff;cursor:pointer;font-size:18px;height:30px;line-height:30px;position:absolute;right:10px;top:10px;width:30px;z-index:100}img{height:100%;width:100%}'),e.Base=z,e.Book=O,e.BookEl=V,e.BookShelf=N,e.BookShelfManager=class{constructor(){this.bookShelf=new N(this),this.bookViewer=new I(this)}getBookViewer(){return this.bookViewer}getBookHolder(e){return this.bookShelf.getBookHolder(e)}getBook(e){return this.bookShelf.getBook(e)}loadAndAddBooks(){return T(this,0,void 0,(function*(){[{id:"book1",status:p.Close,title:"Book 1",type:l.Magazine,author:"Shinkee",publication:{name:"Magzog",location:"Auckland in New Zealand",publishedDate:"2022-09-01"},size:new s({closed:{width:600,height:900,diagonal:0},opened:{width:1200,height:900,diagonal:0}}),lastPageIndex:5,thumbnails:{spine:"resources/cover.jpg",small:"resources/cover.jpg",medium:"resources/cover.jpg",cover:{front:"resources/cover.jpg",back:"resources/cover.jpg"}}}].forEach((e=>{this.addBookToShelf(e)}))}))}loadAndAddBook(e){return T(this,0,void 0,(function*(){const e={id:"book6",status:p.Close,title:"The Great Gatsby",type:l.Magazine,author:"Shinkee",publication:{name:"Magzog",location:"Auckland in New Zealand",publishedDate:"2021-09-01"},size:new s({closed:{width:600,height:900,diagonal:0},opened:{width:1200,height:900,diagonal:0}}),lastPageIndex:5,thumbnails:{spine:"resources/cover.webp",small:"resources/cover.webp",medium:"resources/cover.webp",cover:{front:"resources/cover.webp",back:"resources/cover.webp"}}};this.addBookToShelf(e)}))}importBookToShelf(e){this.bookShelf.addBook(e,{click:t=>{this.pickupAndView(this.getBook(e.id))}})}addBookToShelf(e){this.bookShelf.addBook(new O(e),{click:t=>{this.pickupAndView(this.getBook(e.id))}})}pickupAndView(e){var t;e.status!=p.Open&&(e.status=p.Open,null===(t=this.bookViewer)||void 0===t||t.view(e))}returnBookToShelf(e){if(e){if(e.status==p.Close)return;e.status=p.Close,this.bookShelf.putbackBook(e)}else;}},e.BookSize=class{constructor(e){this.closed=new t(e.closed.width,e.closed.height),this.opened=new t(e.opened.width,e.opened.height)}},e.BookViewer=I,e.FlipActionLine=G,e.FlipData=W,e.FlipDiagonal=_,e.FlipDiagonals=j,e.FlipView=class{get pageContainerRect(){var e;const t=null===(e=this.book)||void 0===e?void 0:e.pageContainerEl;if(!t)throw new Error("Not found the page container.");return t&&q.getOffset4Fixed(t)}get isFlipping(){return this.flipManager.eventStatus&v.AutoFlip||this.flipManager.eventStatus&v.Flipping||this.flipManager.eventStatus&v.Dragging}get isLeftPageFlipping(){return this.isFlipping&&this.flipManager.eventZone&k.Left}get isRightPageFlipping(){return this.isFlipping&&this.flipManager.eventZone&k.Right}get isFirstPageOpening(){var e;return this.isRightPageFlipping&&0==(null===(e=this.getActivePage(1))||void 0===e?void 0:e.index)}get isFirstPageClosing(){var e;return this.isLeftPageFlipping&&0==(null===(e=this.getActivePage(2))||void 0===e?void 0:e.index)}get isLastPageOpening(){var e,t;return this.isLeftPageFlipping&&(null===(e=this.getActivePage(1))||void 0===e?void 0:e.index)==(null===(t=this.book)||void 0===t?void 0:t.lastPageIndex)}get isLastPageClosing(){var e,t;return this.isRightPageFlipping&&(null===(e=this.getActivePage(2))||void 0===e?void 0:e.index)==(null===(t=this.book)||void 0===t?void 0:t.lastPageIndex)}getActivePage(e){return this.isLeftPageFlipping?this.flipManager.windows[3-e].page:this.flipManager.windows[2+e].page}get activePage2(){return this.getActivePage(2)}get activePage1El(){var e;return null===(e=this.getActivePage(1))||void 0===e?void 0:e.element}get activePage2El(){var e;return null===(e=this.getActivePage(2))||void 0===e?void 0:e.element}constructor(){this.zoomLevel=1,this.id="flip-view",this.curOpenLeftPageIndex=-1,this.isSpreadOpen=!1,this.flipManager=new U,this.checkNum=0,({bookContainerEl:this.bookContainerEl,zoneLT:this.zoneLT,zoneLC:this.zoneLC,zoneLB:this.zoneLB,zoneRT:this.zoneRT,zoneRC:this.zoneRC,zoneRB:this.zoneRB,mask1Shape:this.maskShapeOnPage1,mask2Shape:this.maskShapeOnPage2}=this.createElements()),this.setEvents()}init(){this.curOpenLeftPageIndex=-1}addStyles(e){const t=document.createElement("style");t.textContent=K,document.head.appendChild(t)}createElements(){const e=document.createElement("div");e.id="bookContainer";const t="http://www.w3.org/2000/svg",i=document.createElement("div"),o=document.createElement("div"),n=document.createElement("div"),s=document.createElement("div"),a=document.createElement("div"),r=document.createElement("div");i.id="mzZoneLT",o.id="mzZoneLC",n.id="mzZoneLB",s.id="mzZoneRT",a.id="mzZoneRC",r.id="mzZoneRB",i.classList.add("event-zone","left"),o.classList.add("event-zone","left"),n.classList.add("event-zone","left"),s.classList.add("event-zone","right"),a.classList.add("event-zone","right"),r.classList.add("event-zone","right"),e.appendChild(i),e.appendChild(o),e.appendChild(n),e.appendChild(s),e.appendChild(a),e.appendChild(r);const h=document.createElementNS(t,"svg");h.setAttribute("width","0"),h.setAttribute("height","0");const l=document.createElementNS(t,"defs");h.appendChild(l);const p=document.createElementNS(t,"mask");p.setAttribute("id","mask1");const d=document.createElementNS(t,"rect");d.setAttribute("id","mask1-rect"),d.setAttribute("x","0"),d.setAttribute("y","0"),d.setAttribute("width","100%"),d.setAttribute("height","100%"),d.setAttribute("fill","white");const c=document.createElementNS(t,"polygon");c.setAttribute("id","mask1-shape"),c.setAttribute("points","0,0"),c.setAttribute("fill","black"),c.setAttribute("stroke","black"),c.setAttribute("stroke-width","1"),p.appendChild(d),p.appendChild(c);const g=document.createElementNS(t,"mask");g.setAttribute("id","mask2");const u=document.createElementNS(t,"rect");u.setAttribute("x","0"),u.setAttribute("y","0"),u.setAttribute("width","100%"),u.setAttribute("height","100%"),u.setAttribute("fill","black");const w=document.createElementNS(t,"polygon");w.setAttribute("id","mask2-shape"),w.setAttribute("points","0,0"),w.setAttribute("fill","white"),g.appendChild(u),g.appendChild(w);const f=document.createElementNS(t,"linearGradient");f.id="shadow1",f.setAttribute("x1","50%"),f.setAttribute("y1","0%"),f.setAttribute("x2","50%"),f.setAttribute("y2","100%");const b=document.createElementNS(t,"stop"),m=document.createElementNS(t,"stop");b.setAttribute("offset","0%"),b.setAttribute("stop-color","rgba(0,0,0,0.8)"),m.setAttribute("offset","100%"),m.setAttribute("stop-color","rgba(0,0,0,0.2)"),f.appendChild(b),f.appendChild(m);const v=document.createElementNS(t,"filter");v.id="sh1BlurFilter",v.setAttribute("x","0%"),v.setAttribute("y","0%"),v.setAttribute("width","100%"),v.setAttribute("height","200%");const k=document.createElementNS(t,"feGaussianBlur");k.setAttribute("in","SourceGraphic"),k.setAttribute("stdDeviation","3"),v.appendChild(k);const y=document.createElementNS(t,"linearGradient");y.id="shadow3",y.appendChild(document.createElementNS(t,"stop")),y.appendChild(document.createElementNS(t,"stop")),y.appendChild(document.createElementNS(t,"stop")),y.appendChild(document.createElementNS(t,"stop")),y.appendChild(document.createElementNS(t,"stop"));const x=document.createElementNS(t,"linearGradient");return x.id="shadow6",x.setAttribute("gradientUnits","userSpaceOnUse"),x.appendChild(document.createElementNS(t,"stop")),x.appendChild(document.createElementNS(t,"stop")),x.appendChild(document.createElementNS(t,"stop")),l.appendChild(p),l.appendChild(g),l.appendChild(f),l.appendChild(v),l.appendChild(y),l.appendChild(x),e.appendChild(h),{bookContainerEl:e,zoneLT:i,zoneLC:o,zoneLB:n,zoneRT:s,zoneRC:a,zoneRB:r,mask1Shape:c,mask2Shape:w}}appendShadowElIntoPageEl(e){const t=e.size.width,i=e.element,o="http://www.w3.org/2000/svg",n=i.getElementsByClassName("shadow1")[0];n&&n.remove();const s=document.createElementNS(o,"svg");s.classList.add("shadow1");const a=document.createElementNS(o,"path");a.setAttribute("class","sh1-path1"),a.setAttribute("d",`M ${t/3} 0 C ${13*t/15} ${t/20}, ${5*t/6} ${t/20}, ${t} 0`);const r=document.createElementNS(o,"path");r.setAttribute("class","sh1-path2"),r.setAttribute("d",`M 0 0 C ${t/6} ${t/20}, ${2*t/15} ${t/20}, ${2*t/3} 0`),s.appendChild(a),s.appendChild(r);const h=i.getElementsByClassName("shadow6")[0];h&&h.remove();const l=document.createElementNS(o,"svg");l.classList.add("shadow6");const p=document.createElementNS(o,"polygon");p.classList.add("shape"),p.setAttribute("points","0,0"),p.setAttribute("fill","white"),l.appendChild(p);const d=i.getElementsByClassName("shadow3")[0];d&&d.remove();const c=document.createElementNS(o,"svg");c.classList.add("shadow3");const g=document.createElementNS(o,"polygon");g.classList.add("shape"),g.setAttribute("points","0,0"),g.setAttribute("fill","url(#shadow3)"),c.appendChild(g);const u=e.contentContainerEl.getElementsByClassName("shadow2")[0];u&&u.remove();const w=document.createElement("div");w.className="shadow2",e.contentContainerEl.appendChild(w),i.appendChild(e.contentContainerEl),i.appendChild(l),i.appendChild(c),i.appendChild(s)}appendShadowEl4AllPage(){var e;const t=null===(e=this.book)||void 0===e?void 0:e.getPages();for(const e in t)this.appendShadowElIntoPageEl(t[e])}getBookContainerEl(){return this.bookContainerEl}updateDimensionWhenRendered(){++this.checkNum>100||setTimeout((()=>{0==this.flipManager.gutter.top&&0==this.flipManager.gutter.bottom?this.updateDimension():this.updateDimensionWhenRendered()}),200)}view(e,t=0){this.init(),this.attachBook(e),this.setBookEventListener(),this.setViewer();const i=this.getStartPageIndexToLoad(t);return this.loadPages(i),this.showPages(i.start),this.updateDimensionWhenRendered(),this.bookContainerEl}closeViewer(){this.init(),this.removeBookEventListener(),this.detachBook()}getNewPages(e){if(!this.book)throw new Error("No book loaded.");const t=this.book,i=e?this.curOpenLeftPageIndex+4:this.curOpenLeftPageIndex-4,o=e?this.curOpenLeftPageIndex-2:this.curOpenLeftPageIndex+2;return{newPage1:t.getPage(i)||t.createEmptyPage(i),newPage2:t.getPage(i+1)||t.createEmptyPage(i+1),removedPage1:t.getPage(o)||t.createEmptyPage(o),removedPage2:t.getPage(o+1)||t.createEmptyPage(o+1)}}updateDimension(){this.curOpenLeftPageIndex<0?this.setReadyToOpenForward():this.curOpenLeftPageIndex>=this.book.lastPageIndex?this.setReadyToOpenBackward():this.setSpreadOpen()}shiftPages(e){const{newPage1:t,newPage2:i,removedPage1:o,removedPage2:n}=this.getNewPages(e),s=this.book;this.curOpenLeftPageIndex=e?this.curOpenLeftPageIndex+2:this.curOpenLeftPageIndex-2,e?(this.flipManager.moveRight(t,i),null==s||s.appendPageEl(t.element),null==s||s.appendPageEl(i.element)):(this.flipManager.moveLeft(t,i),null==s||s.prependPageEl(i.element),null==s||s.prependPageEl(t.element)),null==s||s.removePageEl(o.element),null==s||s.removePageEl(n.element),this.updateDimension(),this.resetShadow1Paths()}attachBook(e){if(this.book=e,!(null==e?void 0:e.element))throw new Error("Error the book opening");this.bookContainerEl.appendChild(e.element),this.appendShadowEl4AllPage()}detachBook(){this.book=void 0,this.flipManager.clearPageWindow()}setReadyToOpenForward(){var e;this.isSpreadOpen=!1,this.bookContainerEl.classList.add("ready-to-open","front");const t=q.getOffset4Fixed(null===(e=this.book)||void 0===e?void 0:e.element);this.flipManager.gutter=new X({width:0,height:0,left:t.left,right:t.left,top:t.top,bottom:t.bottom})}setReadyToOpenBackward(){var e;this.isSpreadOpen=!1,this.bookContainerEl.classList.add("ready-to-open","end");const t=q.getOffset4Fixed(null===(e=this.book)||void 0===e?void 0:e.element);this.flipManager.gutter=new X({width:0,height:0,left:t.right,right:t.right,top:t.top,bottom:t.bottom})}setSpreadOpen(){var e;this.isSpreadOpen=!0,this.bookContainerEl.classList.remove("ready-to-open","front","end");const t=q.getOffset4Fixed(null===(e=this.book)||void 0===e?void 0:e.element);this.flipManager.gutter=new X({width:0,height:0,left:t.left+t.width/2,right:t.left+t.width/2,top:t.top,bottom:t.bottom})}resetShadow1Paths(){var e,t,i;const o=null===(e=this.book)||void 0===e?void 0:e.element.querySelectorAll(".sh1-path1"),n=null===(t=this.book)||void 0===t?void 0:t.element.querySelectorAll(".sh1-path2"),s=(null===(i=this.book)||void 0===i?void 0:i.size.closed.width)||0;null==o||o.forEach((e=>{e.setAttribute("d",`M ${s/3} 0 C ${13*s/15} ${s/20}, ${5*s/6} ${s/20}, ${s} 0`)})),null==n||n.forEach((e=>{e.setAttribute("d",`M 0 0 C ${s/6} ${s/20}, ${2*s/15} ${s/20}, ${2*s/3} 0`)}))}setViewer(){if(!this.book)throw new Error("Book object does not exist.");const{closed:e,opened:t}=this.book.size,i=document.getElementById("mask1-rect");i&&(i.setAttribute("width",`${this.book.size.closed.width}px`),i.setAttribute("height",`${this.book.size.closed.height}px`));const o=document.documentElement.style;o.setProperty("--opened-book-width",`${t.width}px`),o.setProperty("--closed-book-width",`${e.width}px`),o.setProperty("--book-height",`${e.height}px`),o.setProperty("--page-width",`${e.width}px`),o.setProperty("--page-height",`${e.height}px`),this.updateDimension(),document.documentElement.style.setProperty("--page-diagonal-length",(e.diagonal||0)+"px")}getStartPageIndexToLoad(e){return{start:e%2==1?e-2:e-3,cnt:this.flipManager.windowSize}}loadPages(e){return Q(this,0,void 0,(function*(){if(!this.book)throw new Error("Error the book opening");return this.book.fetchPages(e)}))}getLoadedViewablePageCnt(){if(!this.book)return 0;let e=this.book.getPageCnt();const t=this.book.getPages();for(const i in t){const o=t[i];(Number(i)<0||o.type==w.Empty)&&--e}return e}showPages(e){const t=this.book;if(!t)throw new Error("Error the book opening");const i=(e=e||-3)+this.flipManager.windowSize;for(let o=e,n=0;o<i;o++,n++){const e=t.getPage(o);if(e)this.flipManager.loadPageToWindow(n,e),t.appendPageEl(e.element);else{const e=t.createEmptyPage(o);this.flipManager.loadPageToWindow(n,e),t.appendPageEl(e.element)}}}flipPage(e,t,i,o,n,s,a,r){const h=this.flipManager.flip(a,r,this.isSpreadOpen),l=this.isLeftPageFlipping;t.setAttribute("points",h.printPage1MaskShape()),i.setAttribute("points",h.printPage2MaskShape()),null==n||n.setAttribute("points",h.printPage2MaskShape()),null==s||s.setAttribute("points",h.printShadow6(this.book.size.opened));let p=h.shadow.closingDistance/(r.width/3);const d=document.documentElement.style,c=h.mask.page2.p1,g=h.mask.page2.p2,u=h.mask.page2.p3;h.mask.page1.p1;const w=h.mask.page1.p2,f=h.mask.page1.p3,b=h.c,m=o&&o[0],v=o&&o[1];let y=r.width/20,x=r.width/3,P=2*r.width/3;if(this.isFirstPageClosing){let e=13*r.width/15;w.x>x&&(y=y*(r.width-w.x)/P,x=w.x,e+=.1*w.x),null==m||m.setAttribute("d",`M ${x} 0 C ${e} ${y}, ${5*r.width/6} ${y}, ${r.width} 0`)}else if(this.isLastPageClosing){let e=2*r.width/15;w.x<P&&(y=y*w.x/P,P=w.x,e-=.1*(r.width-w.x)),null==v||v.setAttribute("d",`M 0 0 C ${r.width/6} ${y}, ${e} ${y}, ${P} 0`)}const C=h.page2.rotate,E=l?.3:.5,S=E/Math.PI,A=C<=Math.PI?E-S*C:E+S*(2*Math.PI-C);d.setProperty("--shadow5-opacity",""+A*p);const B=document.getElementById("shadow3");let F,L,M,z=100;const T=this.flipManager.eventZone&k.Top||this.flipManager.eventZone&k.Center;let V=1,R=new D({x:.5,y:.5});l?(b<0?z=0:c==g||(f.x<w.x?(V=w.x,R=q.findPerpendicularFoot(new Z({x:w.x-f.x,y:0},{x:0,y:w.x}),{x:w.x,y:w.x})):(V=f.x,R=q.findPerpendicularFoot(new Z({x:0,y:0},{x:f.x-w.x,y:f.x}),{x:f.x,y:T?0:f.x}),T&&(z=0))),M=100):(b<0?z=0:c==g||(u.x<g.x?(V=g.x,R=q.findPerpendicularFoot(new Z({x:u.x,y:0},{x:g.x,y:g.x}),{x:0,y:g.x})):(V=u.x,R=q.findPerpendicularFoot(new Z({x:u.x,y:0},{x:g.x,y:u.x}),{x:0,y:T?0:u.x}),T&&(z=0))),M=0),F=100*(R.x/V||0),L=100*(R.y/V||0),B&&(B.setAttribute("x1",`${F}%`),B.setAttribute("y1",`${L}%`),B.setAttribute("x2",`${M}%`),B.setAttribute("y2",`${z}%`));const $=null==B?void 0:B.querySelectorAll("stop");$&&(p=p>1?1:p,$[0].setAttribute("offset","0.5%"),$[0].setAttribute("stop-color",`rgba(255, 255, 255, ${.7*p})`),$[1].setAttribute("offset","5%"),$[1].setAttribute("stop-color",`rgba(255, 255, 255, ${.5*p})`),$[2].setAttribute("offset","12%"),$[2].setAttribute("stop-color",`rgba(255, 255, 255, ${.7*p})`),$[3].setAttribute("offset","50%"),$[3].setAttribute("stop-color",`rgba(0, 0, 0, ${.208*p})`),$[4].setAttribute("offset","100%"),$[4].setAttribute("stop-color","rgba(255, 255, 255, 0)"));const O=new D,N=new D,I=new Z(new D,new D);l?(O.x=2*r.width,N.x=0,I.p1.x=w.x,I.p1.y=w.y,I.p2.x=f.x,I.p2.y=f.y):(O.x=0,N.x=2*r.width,I.p1.x=r.width+w.x,I.p1.y=w.y,I.p2.x=r.width+f.x,I.p2.y=f.y),this.flipManager.eventZone&k.Top?(O.y=r.height,N.y=0):(O.y=0,N.y=r.height),R=q.findPerpendicularFoot(I,O);const G=q.findPerpendicularFoot(I,N),W=q.getLength(O,N),H=q.getLength(G,N),_=(1-h.shadow.closingDistance/W)*(H/W)*100,j=document.getElementById("shadow6");j&&(j.setAttribute("x1",`${R.x}`),j.setAttribute("y1",`${R.y}`),j.setAttribute("x2",`${O.x}`),j.setAttribute("y2",`${O.y}`));const X=null==j?void 0:j.querySelectorAll("stop");X&&(X[0].setAttribute("offset","0%"),X[0].setAttribute("stop-color","rgba(255, 255, 255, 0)"),X[1].setAttribute("offset","0%"),X[1].setAttribute("stop-color",`rgba(0, 0, 0, ${_/100})`),X[2].setAttribute("offset",`${_}%`),X[2].setAttribute("stop-color","rgba(0, 0, 0, 0")),d.setProperty("--page2-top",`${h.page2.top}px`),d.setProperty("--page2-left",`${h.page2.left}px`),d.setProperty("--page2-rotate",`${h.page2.rotate}rad`)}setViewerToAutoFlip(){const e=this.isLeftPageFlipping?"left":"right";this.bookContainerEl.classList.add(`${e}-page-flipping`)}unsetViewerToAutoFlip(){this.bookContainerEl.classList.remove("left-page-flipping","right-page-flipping")}setViewerToFlip(){const e=this.isLeftPageFlipping?"left":"right";this.bookContainerEl.classList.add(`${e}-page-flipping`,"noselect"),this.flipManager.curAutoFlipWidth=0}unsetViewerToFlip(){this.bookContainerEl.classList.remove("noselect","left-page-flipping","right-page-flipping")}zoneMouseEntered(e,t){var i,o;if(this.flipManager.eventStatus&v.Flipping||this.flipManager.eventStatus&v.Dragging)return;this.flipManager.eventStatus=v.AutoFlipFromCorner,this.flipManager.eventZone=t.zone;const n=this.activePage2El;if(!n)return;const s=null===(i=this.activePage1El)||void 0===i?void 0:i.querySelectorAll(".shadow1 > path"),a=n.querySelector(".shadow3 > polygon.shape"),r=null===(o=this.activePage1El)||void 0===o?void 0:o.querySelector(".shadow6 > polygon.shape"),h=e,l={x:h.clientX,y:h.clientY};this.setViewerToAutoFlip(),this.flipManager.setInitFlipping(t.zone,l,this.pageContainerRect),this.flipManager.animateFlipFromCorner(l,{width:n.offsetWidth,height:n.offsetHeight},((e,t)=>{this.flipPage(n,this.maskShapeOnPage1,this.maskShapeOnPage2,s,a,r,e,t)}),(()=>{}))}zoneMouseDowned(e,t){var i,o;if(this.flipManager.eventStatus&v.Flipping)return;this.flipManager.eventStatus=v.Dragging,this.flipManager.eventZone=t.zone;const n=e,s={x:n.clientX,y:n.clientY},a=this.activePage2El;if(!a)return;if(!this.pageContainerRect)return;const r=null===(i=this.activePage1El)||void 0===i?void 0:i.querySelectorAll(".shadow1 > path"),h=a.querySelector(".shadow3 > polygon.shape"),l=null===(o=this.activePage1El)||void 0===o?void 0:o.querySelector(".shadow6 > polygon.shape");this.setViewerToFlip(),this.flipManager.setInitFlipping(t.zone,s,this.pageContainerRect),this.flipPage(a,this.maskShapeOnPage1,this.maskShapeOnPage2,r,h,l,s,{width:a.offsetWidth,height:a.offsetHeight})}zoneMouseMoved(e,t){var i,o;if(this.flipManager.eventStatus===v.None)return void this.zoneMouseEntered(e,t);if(this.flipManager.eventStatus!==v.AutoFlipFromCorner)return;if(this.flipManager.eventZone&k.Center)return;this.flipManager.eventZone=t.zone;const n=this.activePage2El;if(!n)return;const s=null===(i=this.activePage1El)||void 0===i?void 0:i.querySelectorAll(".shadow1 > path"),a=n.querySelector(".shadow3 > polygon.shape"),r=null===(o=this.activePage1El)||void 0===o?void 0:o.querySelector(".shadow6 > polygon.shape"),h=e,l={x:h.clientX,y:h.clientY};this.flipPage(n,this.maskShapeOnPage1,this.maskShapeOnPage2,s,a,r,l,{width:n.offsetWidth,height:n.offsetHeight})}zoneMouseLeaved(e,t){var i,o;if(this.flipManager.eventStatus!==v.AutoFlipFromCorner)return;this.flipManager.eventStatus=v.AutoFlipToCorner;const n=this.activePage2El;if(!n)return;const s=null===(i=this.activePage1El)||void 0===i?void 0:i.querySelectorAll(".shadow1 > path"),a=n.querySelector(".shadow3 > polygon.shape"),r=null===(o=this.activePage1El)||void 0===o?void 0:o.querySelector(".shadow6 > polygon.shape"),h=e,l={x:h.clientX,y:h.clientY};this.flipManager.eventZone=t.zone,this.flipManager.animateFlipToCorner(l,{width:n.offsetWidth,height:n.offsetHeight},((e,t)=>{this.flipPage(n,this.maskShapeOnPage1,this.maskShapeOnPage2,s,a,r,e,t)}),(()=>{this.flipManager.eventStatus==v.AutoFlipToCorner&&(this.unsetViewerToAutoFlip(),this.flipManager.eventStatus=v.None)}))}documentMouseUp(e){var t,i;if(!(this.flipManager.eventStatus&v.Dragging))return;const o=this.activePage2El;if(!o)return;const n=e,s={x:n.clientX,y:n.clientY},a=this.flipManager.getInfoToFlip(s);a.isSnappingBack?this.flipManager.eventStatus=v.SnappingBack:this.flipManager.eventStatus=a.isFlippingForward?v.FlippingForward:v.FlippingBackward;const r=null===(t=this.activePage1El)||void 0===t?void 0:t.querySelectorAll(".shadow1 > path"),h=o.querySelector(".shadow3 > polygon.shape"),l=null===(i=this.activePage1El)||void 0===i?void 0:i.querySelector(".shadow6 > polygon.shape");this.flipManager.animateFlip(s,a.targetCornerGP,{width:o.offsetWidth,height:o.offsetHeight},((e,t)=>{this.flipPage(o,this.maskShapeOnPage1,this.maskShapeOnPage2,r,h,l,e,t)}),(()=>{a.isSnappingBack||this.shiftPages(a.isFlippingForward),this.unsetViewerToFlip(),this.flipManager.eventStatus=v.None}))}documentMouseMove(e){var t,i;const o=e,n={x:o.clientX,y:o.clientY};if(this.flipManager.curMouseGP=n,!(this.flipManager.eventStatus&v.Dragging))return;const s=this.activePage2El;if(!s)return;const a=null===(t=this.activePage1El)||void 0===t?void 0:t.querySelectorAll(".shadow1 > path"),r=s.querySelector(".shadow3 > polygon.shape"),h=null===(i=this.activePage1El)||void 0===i?void 0:i.querySelector(".shadow6 > polygon.shape");this.flipPage(s,this.maskShapeOnPage1,this.maskShapeOnPage2,a,r,h,n,{width:s.offsetWidth,height:s.offsetHeight})}setEvents(){[{zoneEl:this.zoneLT,zone:k.LT},{zoneEl:this.zoneLC,zone:k.LC},{zoneEl:this.zoneLB,zone:k.LB},{zoneEl:this.zoneRT,zone:k.RT},{zoneEl:this.zoneRC,zone:k.RC},{zoneEl:this.zoneRB,zone:k.RB}].forEach((({zoneEl:e,zone:t})=>{e.addEventListener("mouseenter",(e=>{this.zoneMouseEntered(e,{zone:t})})),e.addEventListener("mouseleave",(e=>{this.zoneMouseLeaved(e,{zone:t})})),e.addEventListener("mousedown",(e=>{this.zoneMouseDowned(e,{zone:t})})),e.addEventListener("mousemove",(e=>{this.zoneMouseMoved(e,{zone:t})}))})),document.addEventListener("mouseup",this.documentMouseUp.bind(this)),document.addEventListener("mousemove",this.documentMouseMove.bind(this)),window.addEventListener("resize",(()=>{this.updateDimension()}))}setBookEventListener(){var e;null===(e=this.book)||void 0===e||e.addEventListener(M.pageAdded,this.appendShadowElIntoPageEl)}removeBookEventListener(){var e;null===(e=this.book)||void 0===e||e.removeEventListener(M.pageAdded,this.appendShadowElIntoPageEl)}},e.Flipping=U,e.Gutter=X,e.Line=class{constructor(e,t){this.p1=e,this.p2=t}},e.MZEvent=class{constructor(){this.listeners={}}addEventListener(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)}removeEventListener(e,t){this.listeners[e]&&(this.listeners[e]=this.listeners[e].filter((e=>e!==t)))}emitEvent(e,...t){this.listeners[e]&&this.listeners[e].forEach((e=>e(...t)))}},e.MZMath=class e{static findSymmetricPoint(e,t){return{x:2*e.x-t.x,y:2*e.y-t.y}}static getDegree(t,i){return 180*e.getRadian(t,i)/Math.PI}static getDegreePositive(t,i){let o=180*e.getRadian(t,i)/Math.PI%360;return o<0&&(o+=360),o}static getRadian(e,t){const i=t.x-e.x,o=t.y-e.y;return Math.atan2(o,i)}static getRadianPositive(e,t){const i=t.x-e.x,o=t.y-e.y;let n=Math.atan2(o,i)%(2*Math.PI);return n<0&&(n+=2*Math.PI),n}static getOffset(e){var t,i,o=0,n=0;let s=e.getBoundingClientRect();i=s.height,t=s.width;do{s=e.getBoundingClientRect(),o+=s.top,n+=s.left,null!==(e=e.offsetParent)&&(s=e.getBoundingClientRect(),o-=s.top-window.scrollY,n-=s.left-window.scrollX)}while(e);return{top:o,left:n,width:t,height:i,bottom:o+i,right:n+t}}static getOffset4Fixed(e){var t,i,n=0,s=0;let a=e.getBoundingClientRect();i=a.height,t=a.width;do{a=e.getBoundingClientRect(),n+=a.top,s+=a.left,null!==(e=e.offsetParent)&&(a=e.getBoundingClientRect(),n-=a.top,s-=a.left)}while(e);return new o({top:n,left:s,width:t,height:i,bottom:n+i,right:s+t})}static getLength(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}static findPointOnLine(e,t,i){const o=t.x-e.x,n=t.y-e.y,s=Math.sqrt(o*o+n*n),a=o/s,r=n/s;return{x:e.x+a*i,y:e.y+r*i}}static findPerpendicularFoot(e,t){const i=e.p2.x-e.p1.x,o=e.p2.y-e.p1.y,n=i*i+o*o;if(0===n)return e.p1;const s=((t.x-e.p1.x)*i+(t.y-e.p1.y)*o)/n;return{x:e.p1.x+i*s,y:e.p1.y+o*s}}},e.Page=$,e.PageEl=R,e.PageWindow=Y,e.Point=i,e.Rect=o,e.SizeExt=t}(this.window=this.window||{});
